# Edgeberry Device Hub — Mosquitto broker config
# Reference: https://mosquitto.org/man/mosquitto-conf-5.html

## Per-listener security settings
per_listener_settings true

## Listener (mTLS only; no passwords)
listener 8883 0.0.0.0
allow_anonymous false

## TLS materials (adjust paths for your environment)
cafile   config/certs/ca.crt
certfile config/certs/server.crt
keyfile  config/certs/server.key

## Require client certificates and map CN→username for ACLs
require_certificate true
use_subject_as_username true

## ACLs for TLS listener
acl_file config/mosquitto.acl

## Local non-TLS listener for internal services only (anonymous, unrestricted)
listener 1883 127.0.0.1
allow_anonymous true
# Permissive ACL for localhost listener only
acl_file config/mosquitto-local-unrestricted.acl

# Persistence
persistence true
persistence_location /mosquitto/data/

# Logging
log_dest stdout
log_type information
connection_messages true

# No message size limit (0 means unlimited); tune for production
max_packet_size 0
