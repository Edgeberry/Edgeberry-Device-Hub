# Edgeberry Device Hub â€” Mosquitto broker config
# Reference: https://mosquitto.org/man/mosquitto-conf-5.html

# Enable per-listener security without splitting broker state
per_listener_settings true

# --- Listener 1: localhost, no TLS/auth (internal microservices) ---
listener 1883 127.0.0.1
allow_anonymous true

# --- Listener 2: external TLS (devices) ---
listener 8883 0.0.0.0
allow_anonymous false
require_certificate true
use_subject_as_username true

# TLS materials (absolute paths). Trust CA via capath so CA rotation is seamless
# capath is managed by edgeberry-ca-rehash.{path,service}
capath   /etc/mosquitto/certs/edgeberry-ca.d
certfile /etc/mosquitto/certs/server.crt
keyfile  /etc/mosquitto/certs/server.key

# ACLs for TLS listener (absolute path)
acl_file /etc/mosquitto/acl.d/edgeberry.acl

# Logging
log_dest stdout
log_dest topic
log_type all
connection_messages true
log_timestamp true

# Publish $SYS hierarchy updates every 10s (broker stats and, with log_dest topic, logs)
sys_interval 10


