# Edgeberry Device Hub â€” Mosquitto DEV config
# Usage (local dev): mosquitto -c "$(pwd)/config/mosquitto-dev.conf"
# Ref: https://mosquitto.org/man/mosquitto-conf-5.html

## Use per-listener security settings so auth/TLS differ per port
per_listener_settings true

## Listener (mTLS)
# Uses certificate-based auth only (no passwords).
listener 8883 0.0.0.0
allow_anonymous false

## TLS materials (place your dev certs here)
# - cafile: Root CA that issued client and server certs
# - certfile/keyfile: Broker server certificate and key
# You can use scripts from provisioning to generate dev materials.
cafile   config/certs/ca.crt
certfile config/certs/server.crt
keyfile  config/certs/server.key

## Require client certificates and use subject CN as username for ACLs
require_certificate true
use_subject_as_username true

## ACLs for TLS listener
acl_file config/mosquitto.acl

## Local non-TLS listener for internal services only (anonymous, unrestricted)
# - Binds to loopback only
# - No TLS, no username/password
listener 1883 127.0.0.1
allow_anonymous true
# Permissive ACL for localhost listener only
acl_file config/mosquitto-local-unrestricted.acl

# Persistence (keeps retained messages, session state)
persistence true
persistence_location ./.mosquitto-data/

# Logging
log_dest stdout
log_type information
connection_messages true

# Reasonable limits for dev
# 0 = unlimited, but keep defaults modest for safety
max_inflight_messages 20

# MQTT v3.1.1/5.0 both ok (default). Enable protocol errors for easier debugging.
check_retain_source true

